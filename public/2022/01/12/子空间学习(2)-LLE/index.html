<!DOCTYPE html>
<html lang="en">

<!-- Head tag (contains Google-Analytics、Baidu-Tongji)-->
<head>
  <!-- Google Analytics -->
  
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-xxxxxx-xx"></script>
    <script type="text/javascript">
      window.dataLayer = window.dataLayer || [];

      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());

      gtag('config', 'UA-xxxxxx-xx');
    </script>
  

  <!-- Baidu Tongji -->
  
    <script type="text/javascript">
      // Originial
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  

  <!-- Baidu Push -->
  
    <script>
      (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
      })();
    </script>
  

  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>

  <meta name="google-site-verification" content="lxDfCplOZbIzjhG34NuQBgu2gdyRlAtMB4utP5AgEBc"/>
  <meta name="baidu-site-verification" content="PpzM9WxOJU"/>

  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="description" content="It&#39;s an IT blog..."/>
  <meta name="keyword" content="Bin&#39;s Blog"/>
  <link rel="shortcut icon" href="/img/avatar/Bin.jpg"/>

  <!-- Place this tag in your head or just before your close body tag. -->
  <script async="async" defer="defer" src="https://buttons.github.io/buttons.js"></script>

  
    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css"/>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/beantech.min.css"/>

    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css"/>
    <link rel="stylesheet" href="/css/widget.css"/>
    <link rel="stylesheet" href="/css/rocket.css"/>
    <link rel="stylesheet" href="/css/signature.css"/>
    <link rel="stylesheet" href="/css/catalog.css"/>
    <link rel="stylesheet" href="/css/livemylife.css"/>

    
      <!-- wave start -->
      <link rel="stylesheet" href="/css/wave.css"/>
      <!-- wave end -->
    

    
      <!-- top start (article top hot config) -->
      <link rel="stylesheet" href="/css/top.css"/>
      <!-- top end -->
    

    
      <!-- ThemeColor start -->
      <link rel="stylesheet" href="/css/scroll.css"/>
      <!-- ThemeColor end -->
    

    
      <!-- viewer start (Picture preview) -->
      <link rel="stylesheet" href="/css/viewer.min.css"/>
      <!-- viewer end -->
    

    
      <!-- Search start -->
      <link rel="stylesheet" href="/css/search.css"/>
      <!-- Search end -->
    

    
      <!-- ThemeColor start -->
      <link rel="stylesheet" href="/css/themecolor.css"/>
      <!-- ThemeColor end -->
    

    

    
      <!-- gitalk start -->
      <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"> -->
      <link rel="stylesheet" href="/css/gitalk.css"/>
      <!-- gitalk end -->
    
  

  <!-- Custom Fonts -->
  <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
  <!-- Hux change font-awesome CDN to qiniu -->
  <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" type="text/css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!-- Hux Delete, sad but pending in China <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'> <link
  href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/ css'> -->

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]> <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script> <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script> <![endif]-->

  <!-- ga & ba script hoook -->
  <link rel="canonical" href="http://yoursite-url/2022/01/12/子空间学习(2)-LLE/">
  <title>
    
      子空间学习(2)-LLE - Bin&#39;s Blog
    
  </title>
<meta name="generator" content="Hexo 5.4.0"></head>


<!-- hack iOS CSS :active style -->

	<body ontouchstart="" class="body--light body--light">


		<!-- ThemeColor -->
		
		<!-- ThemeColor -->
<style type="text/css">
  .body--light {
    --light-mode: none;
    --dark-mode: block;
  }
  .body--dark {
    --light-mode: block;
    --dark-mode: none;
  }
  i.mdui-icon.material-icons.light-mode {
    display: var(--light-mode);
  }
  i.mdui-icon.material-icons.dark-mode {
    display: var(--dark-mode);
  }
</style>
<div class="toggle" onclick="document.body.classList.toggle('body--dark')">
  <i class="mdui-icon material-icons light-mode"></i>
  <i class="mdui-icon material-icons dark-mode"></i>
</div>
<script>
  //getCookieValue
  function getCookieValue(a) {
    var b = document.cookie.match('(^|[^;]+)\\s*' + a + '\\s*=\\s*([^;]+)');
    return b
      ? b.pop()
      : '';
  }
  let themeMode = 'light';
  if (getCookieValue('sb-color-mode') && (getCookieValue('sb-color-mode') !== themeMode)) {
    let dbody = document.body.classList;
    themeMode === 'dark' ? dbody.remove('body--dark') : dbody.add('body--dark');
  }

  //setCookieValue
  var toggleBtn = document.querySelector(".toggle");
  toggleBtn.addEventListener("click", function () {
    var e = document.body.classList.contains("body--dark");
    var cookieString = e
      ? "dark"
      : "light";
    var exp = new Date();
    exp.setTime(exp.getTime() + 3 * 24 * 60 * 60 * 1000); //3天过期
    document.cookie = "sb-color-mode=" + cookieString + ";expires=" + exp.toGMTString() + ";path=/";
  });
</script>

		

		<!-- Gitter -->
		
		<!-- Gitter -->
<!-- Docs:https://gitter.im/?utm_source=left-menu-logo -->
<script>
  ((window.gitter = {}).chat = {}).options = {
    room: 'your-community/your-room'
  };
</script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>

		

		<!-- Navigation (contains search)-->
		<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header page-scroll">
      <button type="button" class="navbar-toggle">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">An Ordinary Life</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <!-- Known Issue, found by Hux: <nav>'s height woule be hold on by its content. so, when navbar scale out, the <nav> will cover tags. also mask any touch event of tags, unfortunately. -->
    <div id="huxblog_navbar">
      <div class="navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
          <li>
            <a href="/">HOME</a>
          </li>

          
          
          <li>
            <a href="/about/">
              
              ABOUT
              
              
            </a>
          </li>
          
          
          
          <li>
            <a href="/archive/">
              
              ARCHIVES
              
              
            </a>
          </li>
          
          
          
          <li>
            <a href="/tags/">
              
              TAGS
              
              
            </a>
          </li>
          
          
          
          
          
          <li>
            <a href="/categories/">
              
              CATEGORIES
              
              
            </a>
          </li>
          
          

          
          <li>
            <a class="popup-trigger">
              <span class="search-icon"></span>SEARCH</a>
          </li>
          

          <!-- LangSelect -->
          
        </ul>
      </div>
    </div>
    <!-- /.navbar-collapse -->
  </div>
  <!-- /.container -->
</nav>
<!-- progress -->
<div id="progress">
  <div class="line" style="width: 0%;"></div>
</div>

<script>
  // Drop Bootstarp low-performance Navbar Use customize navbar with high-quality material design animation in high-perf jank-free CSS3 implementation
  var $body = document.body;
  var $toggle = document.querySelector('.navbar-toggle');
  var $navbar = document.querySelector('#huxblog_navbar');
  var $collapse = document.querySelector('.navbar-collapse');

  $toggle.addEventListener('click', handleMagic)

  function handleMagic(e) {
    if ($navbar.className.indexOf('in') > 0) {
      // CLOSE
      $navbar.className = " ";
      // wait until animation end.
      setTimeout(function() {
        // prevent frequently toggle
        if ($navbar.className.indexOf('in') < 0) {
          $collapse.style.height = "0px"
        }
      }, 400)
    } else {
      // OPEN
      $collapse.style.height = "auto"
      $navbar.className += " in";
    }
  }
</script>


		<!-- Post Header (contains intro-header、signature、wordcount、busuanzi、waveoverlay) -->
		<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->

  <style type="text/css">
    .body--light {
      /* intro-header */
      --intro-header-background-image-url-home: url('/img/header_img/newhome_bg.jpg');
      --intro-header-background-image-url-post: url('/img/header_img/lml_bg.jpg');
      --intro-header-background-image-url-page: url('//img/header_img/lml_bg.jpg');
    }
    .body--dark {
      --intro-header-background-image-url-home: linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.2)), url('/img/header_img/newhome_bg.jpg');
      --intro-header-background-image-url-post: linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.2)), url('/img/header_img/lml_bg.jpg');
      --intro-header-background-image-url-page: linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.2)), url('//img/header_img/lml_bg.jpg');
    }

    header.intro-header {
       /*post*/
        background-image: var(--intro-header-background-image-url-post);
        /* background-image: url('/img/header_img/lml_bg.jpg'); */
      
    }

    
  </style>





<header class="intro-header">
  <!-- Signature -->
  <div id="signature">
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
          
          <div class="post-heading">
            <div class="tags">
              
              <a class="tag" href="/tags/#Python" title="Python">Python</a>
              
            </div>
            <h1>子空间学习(2)-LLE</h1>
            <h2 class="subheading">Subspace Learning-LLE</h2>
            <span class="meta">
              Posted by Mr.Li on
              2022-01-12
            </span>


            
            <!-- WordCount start -->
            <div class="blank_box"></div>
            <span class="meta">
              Estimated Reading Time <span class="post-count">10</span> Minutes
            </span>
            <div class="blank_box"></div>
            <span class="meta">
              Words <span class="post-count">2.3k</span> In Total
            </span>
            <div class="blank_box"></div>
            <!-- WordCount end -->
            
            


          </div>
          
        </div>
      </div>
    </div>
  </div>

  
  <!-- waveoverlay start -->
  <div class="preview-overlay">
    <svg class="preview-waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
      <defs>
        <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path>
      </defs>
      <g class="preview-parallax">
        <use xlink:href="#gentle-wave" x="48" y="0" fill=var(--gentle-wave1)></use>
        <use xlink:href="#gentle-wave" x="48" y="3" fill=var(--gentle-wave2)></use>
        <use xlink:href="#gentle-wave" x="48" y="5" fill=var(--gentle-wave3)></use>
        <use xlink:href="#gentle-wave" x="48" y="7" fill=var(--gentle-wave)></use>
      </g>
    </svg>
  </div>
  <!-- waveoverlay end -->
  

</header>



		<!-- Main Content (Post contains
	Pager、
	tip、
	socialshare、
	gitalk、gitment、disqus-comment、
	Catalog、
	Sidebar、
	Featured-Tags、
	Friends Blog、
	anchorjs、
	) -->
		<!-- Modify by Yu-Hsuan Yen -->
<!-- Post Content -->
<article>
  <div class="container">
    <div class="row">
      <!-- Post Container -->
      <div class="col-lg-8 col-lg-offset-1 col-md-10 col-md-offset-1 post-container">

        <blockquote>
<p>子空间学习系列主要讨论从PCA发表开始到2010年中，子空间学习相关论文。本文立足于论文：<strong>Think Globally, Fit Locally- Unsupervised Learning of Low Dimensional Manifolds（2003 JMLR）</strong>。基于此进行概念的梳理和思考，尝试从数学的角度去阐述LLE的动机，目标函数和限制等。额，然后本系列的解释应该是中英文混合，私以为用简略的句子生动地描述复杂抽象的概念，需要对算法有着极为深刻的理解和一定的勇气。显然我水平不够，如果强制翻译一些原文的描述和概念，难免不太妥当。</p>
</blockquote>
<h1 id="摘要："><a href="#摘要：" class="headerlink" title="摘要："></a>摘要：</h1><p>降维算法出现在信息处理的许多领域，包括机器学习、数据压缩、科学可视化、模式识别和神经计算。 其中，Locally Linear Embedding（局部线性嵌入）是一种无监督学习算法，可计算高维输入的低维、邻域保留嵌入。 我们假设输入是从一个底层流形中采样的，并被映射到一个低维的单一全局坐标系中。 映射源自局部线性重建的对称性，嵌入的实际计算简化为稀疏特征值问题。 在本报告中，我们尝试以数学方式解释 LLE 的主要思想，并讨论 PCA 和 LLE 之间的区别。本文的解释会比较简略只提重点部分。需要注意的是本文有下划线的部分是一些需要了解的基础概念，由于篇幅，我就不在后面解释，望读者自行查阅。</p>
<h1 id="Question-amp-Answer："><a href="#Question-amp-Answer：" class="headerlink" title="Question&amp;Answer："></a>Question&amp;Answer：</h1><h2 id="假设"><a href="#假设" class="headerlink" title="假设"></a>假设</h2><p>LLE 假设数据是从平滑的底层流形中采样的，并且有足够的数据（使得流形采样良好）。具体来说，</p>
<ul>
<li><p>数据是从<u>光滑流形</u>中采样的，即数据是无限可微的。 光滑流形的一阶导数的连续性主要用于 LLE，即</p>
<script type="math/tex; mode=display">
\begin{aligned}
        &\lim _{x \rightarrow x_{0}^{-}} f_{(x)}=f_{\left(x_{0}\right)}=\lim _{x \rightarrow x_{0}^{+}} f_{(x)} \\
        &\lim _{x \rightarrow x_{0}^{-}} f_{(x)}^{\prime}=f_{\left(x_{0}\right)}^{\prime}=\lim _{x \rightarrow x_{0}^{+}} f_{(x)}^{\prime}.
    \end{aligned}</script></li>
<li><p>数据采样良好意味着采样密度是每个数据点都具有 $2d$ 邻居的数量级，这些邻居在流形上相对于输入空间中的某个度量定义了一个大致线性的补丁。</p>
</li>
</ul>
<h2 id="解决的问题"><a href="#解决的问题" class="headerlink" title="解决的问题"></a>解决的问题</h2><p>LLE 是一种降维算法，它计算高维数据的低维、邻域保留嵌入，即将从底层流形采样（带有噪声）的高维数据映射到低维的单个全局坐标系中。</p>
<h2 id="目标函数"><a href="#目标函数" class="headerlink" title="目标函数"></a>目标函数</h2><p>LLE的目标函数是为了最小化重构损失，最大程度的保持数据之间的局部关系（为什么保持数据间的局部关系可以进行更好的降维？下一个回答将解释）：</p>
<script type="math/tex; mode=display">
\begin{aligned}
        \arg \min_{W} E(W) &= \sum_{i}|X_{i}-\sum_{j}W_{ij}X_{ij}|^2 \\
        \arg \min_{Y} \Phi(Y) &= \sum_{i}|Y_{i}-\sum_{j}W_{ij}Y_{ij}|^2 
    \end{aligned}\tag{1}</script><script type="math/tex; mode=display">
\text{ s.t. } \ \sum_{i=1}^{N} Y_{i}=0,\ \sum_{i=1}^{N} Y_{i} Y_{i}^{T}=N I_{d \times d},\ \sum_{j}W_{ij}=1</script><h2 id="逐字理解Locally-Linear-Embedding的含义"><a href="#逐字理解Locally-Linear-Embedding的含义" class="headerlink" title="逐字理解Locally Linear Embedding的含义"></a>逐字理解Locally Linear Embedding的含义</h2><h3 id="Locally"><a href="#Locally" class="headerlink" title="Locally"></a>Locally</h3><p>“Locally”指的是<strong>流形的局部不变性</strong>。由流形的定义可知，流形中的每一点$X_{a}$都有一个邻域$X_{U(a)}$，这个邻域同胚于欧氏空间中的一个开集$W_{a}$，如下所示：</p>
<script type="math/tex; mode=display">
\begin{gathered}
        \forall X_{a} \ \exists X_{U(a)} : \ f(X_{U(a)})\rightarrow W_{a} \ (W_{a} \subseteq \mathbb{R}^{n}) \\
        \forall Y_{a} \ \exists Y_{U(a)} : \ f(Y_{U(a)})\rightarrow W_{a} \ (W_{a} \subseteq \mathbb{R}^{n})
    \end{gathered}\tag{2}</script><p>其中 $W_{a}$ 是不变的，$X$ 是高维数据，$Y$ 是低维数据。更具体地说，LLE 中的“Locally”使用<strong>KNN</strong>为每个重建做出贡献。我们可以通过不同的测距方法获得数据点 $X_{i}$ 的 $k$ 最近邻居，例如由欧几里得距离测量，</p>
<script type="math/tex; mode=display">
\begin{gathered}
        D_{i,j}\!=\!\sqrt{(X_{i,1}\!-\!X_{j,1})^2\!+\!(X_{i,2}\!-\!X_{j,2})^2\!+\!\cdots\!+\!(X_{i,D}\!-\!X_{j,D})^2}\\
        sort(\lbrace D_{i,j}|1\leq i,j\leq D\rbrace),
    \end{gathered}</script><p>其中 $D_{i,j}$ 表示 D 维向量 $X_{i}$ 和 $X_{j}$ 的距离。我们对$D_{i,j}$进行排序，得到$X_{i}$的$k$个最近邻，即选择$k$个最小的$D_{i,j}$。更进一步，我们将解释为什么可以使用欧几里得距离来确定不变场。</p>
<p>公式（1）指我们可以用欧几里得空间中的坐标系$\tau$来表示流形中$X_{a}$点的邻域。所以$\tau$中点的欧几里德距离代表了点$X_{a}$与其在流形中的邻域之间的关系，即流形可以局部抽象为欧氏空间。然而，当邻域太大而不能被视为欧几里得空间时，局部不变性将失效。</p>
<h3 id="Linear"><a href="#Linear" class="headerlink" title="Linear"></a>Linear</h3><p>“Linear”指计算权重 $W_{ij}$ 最好从 $X_{i}$的邻居$X_{U(i)}$中线性重建数据点 $X_{i}$，即最小化约束的，线性的，目标函数，见等式：</p>
<script type="math/tex; mode=display">
\begin{gathered}
        \arg \min_{W} E(W) = \sum_{i}|X_{i}-\sum_{j}W_{ij}X_{ij}|^2 \\
        \text{ s.t. }\sum_{j}W_{ij}=1,
    \end{gathered}\tag{3}</script><p>其中 $X_{ij}$ 是 $X_{i}$ 的邻居，$\sum_{j}W_{ij}X_{ij}$ 是局部线性重建。 此外，我们解释了为什么我们需要约束 $\sum_{j}W_{ij}=1$。约束是<strong>平移不变性、旋转不变性和伸缩不变性</strong>的必要条件，并且可以通过约束$\sum_{j}W_{ij}=1$来使用<u>拉格朗日乘子法</u>来最小化重构误差。</p>
<p>更进一步，我们给出了平移不变性、旋转不变性和伸缩不变性的证明。现在，我们证明平移不变性，看下面的推导，</p>
<script type="math/tex; mode=display">
\begin{aligned}
        \Phi(Y)&\!=\!\sum_{i=1}^{N}\left\|Y_{i}\!-\!\sum_{j=1}^{k} W_{ij} Y_{ij}\right\|^{2}\!=\!\sum_{i=1}^{N}\left\|\sum_{j=1}^{k}\left(Y_{i}\!-\!Y_{ij}\right) W_{ij}\right\|^{2} \\
        &\!=\!\sum_{i=1}^{N}\left\|\sum_{j=1}^{k}((Y_{i}\!-\!\frac{\sum_{i}Y_{i}}{2})\!-\!(Y_{ij}\!-\!\frac{\sum_{i}Y_{i}}{2}))W_{ij}\right\|^{2}.
    \end{aligned}\tag{4}</script><p>其中 $\frac{\sum_{i}Y_{i}}{2}$ 是平移量。然后，我们根据方程证明旋转不变性和伸缩不变性，看下面的推导，</p>
<script type="math/tex; mode=display">
\begin{aligned}
        \Phi(AY)&=\sum_{i}\left\|AY_{i}-\sum_{j}W_{ij}AY_{ij}\right\|^2\\
        &=\sum_{i}\left\|\sum_{j}W_{ij}(AY_{i}-AY_{ij})\right\|^2\\
        &=\sum_{i}(I_{i}-W_{i})^{T}Y^{T}A^{T}AY(I_{i}-W_{i})\\
        &=\sum_{i}(I_{i}-W_{i})^{T}Y^{T}Y(I_{i}-W_{i})=\Phi(Y),
    \end{aligned}\tag{5}</script><p>其中 $A$ 是旋转（伸缩）和 $\left|A\right|=0$。因此，第二个约束通过将 $\vec{Y}_{i}$ 约束为具有单位阵来消除旋转自由度。同时，第二个约束将比例固定为 d 维，即降维后的维度。</p>
<h3 id="Embedding"><a href="#Embedding" class="headerlink" title="Embedding"></a>Embedding</h3><p>LLE 中的“Embedding”是指将高维数据点 $X_{i}$ 映射到低维嵌入坐标。 在这一步中，LLE 试图最小化重构损失，见等式，</p>
<script type="math/tex; mode=display">
\begin{gathered}
        \arg \min_{Y} \Phi(Y) = \sum_{i}|Y_{i}-\sum_{j}W_{ij}Y_{ij}|^2 \\
        \text { s.t. } \sum_{i=1}^{N} Y_{i}=0, \sum_{i=1}^{N} Y_{i} Y_{i}^{T}=N I_{d \times d},
    \end{gathered}\tag{6}</script><p>其中降维后的数据$Y$ 是由权重 $W$ 重建。 因此，输出 $Y_{i}$ 是高维输入 $X_{i}$ 的低维嵌入。 通过在不影响损失函数的情况下添加约束，目标函数具有唯一的全局最小值。 </p>
<h2 id="具体的推导过程"><a href="#具体的推导过程" class="headerlink" title="具体的推导过程"></a>具体的推导过程</h2><p>在这一部分，我们展示了 LLE 解决方案的细节。我们可以转化(3)为具有两个变量和一个约束的优化问题，</p>
<script type="math/tex; mode=display">
\begin{aligned}
        \Phi(W)&\!=\!\sum_{i=1}^{N}\left\|X_{i}\!-\!\sum_{j=1}^{k} W_{ij} X_{ij}\right\|^{2}\!=\!\sum_{i=1}^{N}\left\|\sum_{j=1}^{k}\left(X_{i}\!-\!X_{ij}\right) W_{ij}\right\|^{2} \\
        &\!=\!\sum_{i=1}^{N}\left\|\left(X_{i\times k}\!\!-\!\!N_{i}\right) W_{i}\right\|^{2}\!\! \\
        &=\!\!\sum_{i=1}^{N}W_{i}^{T}\!\!\left(X_{i\times k}\!\!-\!\!N_{i}\right)^{T}\!\!\!\left(X_{i\times k}\!\!-\!\!N_{i}\right)W_{i}\\
        &\!=\!\sum_{i=1}^{N} W_{i}^{T} S_{i} w_{i},\ S_{i}\!=\!\left(X_{i\times k}\!-\!N_{i}\right)^{T}\!\!\left(X_{i\times k}\!-\!N_{i}\right)\\
        & \text{ s.t. } W_{i}^{T}1_{k\times 1}=1 ,
    \end{aligned}\tag{7}</script><p>其中 $X_{i\times k}=\underbrace{\left[X_{i}, \ldots, X_{i}\right]}_{k}$ 和 $N_{i}=\left[X_{i1 }, \ldots, X_{ik}\right]$。接下来，我们将<u>拉格朗日乘数法</u>应用于方程(7)，然后得到权重 $W=[W_{1}, W_{2}, \cdots, W_{N}]$，见(8)，</p>
<script type="math/tex; mode=display">
\begin{aligned}
        L(W_{i})&=\sum_{i=1}^{N} W_{i}^{T} S_{i} W_{i}+\lambda (W_{i}^{T}1_{k\times 1}-1) \\
        \frac{\partial L}{\partial W_{i}}&=2S_{i}W_{i}+\lambda 1_{k\times 1}\\
        W_{i}&=\frac{S_{i}^{-1}1_{k\times 1}}{1_{k\times 1}^{T}S_{i}^{-1}1_{k\times 1}}.
    \end{aligned}\tag{8}</script><p>此外，我们将使用重建权重 $W$ 来获得输出 $Y$。更进一步，我们转换优化公式(6)，</p>
<script type="math/tex; mode=display">
\begin{aligned}
        \Phi(Y)&= \sum_{i}\|Y_{i}-\sum_{j}W_{ij}Y_{ij}\|^2\\
        &=\sum_{i=1}^{N}\|Y(I_{i}-W_{i})\|^2\\
        &=tr(Y(I-W)(I-W)^{T}Y^{T})\\
        &=tr(YMY^{T}),\ M=(I-W)(I-W)^{T}
    \end{aligned}\tag{9}</script><p>其中 $Y=[y_{1}, y_{2}, \cdots, y_{N}]$, $\mathbb{X}_{i}$ 是包含 $X_{i}$的$k$ 个最近邻居点的集合。然后利用公式（6）中的约束，我们可以通过拉格朗日乘子法和特征分解求解问题（9），见如下过程，</p>
<script type="math/tex; mode=display">
 \begin{gathered}
        L(Y)=YMY^{T}+\lambda(YY^{T}-NI)\\
        \frac{\partial L}{\partial Y}=2MY^{T}+2\lambda Y^{T}=0\\
        MY^{T}=\lambda^{-1}Y^{T}\\
        sort(\lambda^{-1}), \ if\ j<k,\ then\ \lambda^{-1}_{j}<\lambda^{-1}_{k}\\
        Output=[Y_{1}, Y_{2}, \cdots, Y_{d}].
    \end{gathered}</script><h2 id="讨论"><a href="#讨论" class="headerlink" title="讨论"></a>讨论</h2><h3 id="PCA和LLE的区别"><a href="#PCA和LLE的区别" class="headerlink" title="PCA和LLE的区别"></a>PCA和LLE的区别</h3><p>PCA 和 LLE 都是降维方法。 但它们在动机、要解决的问题和目标函数上是不同的。 我们假设$A$是原始数据，$B$是降维后的数据。 同时，$D$ 是$A$ 的维度，$d$ 是$B$ 的维度。 现在我们从 PCA 和 LLE 的不同动机开始解释。</p>
<p>PCA 试图通过线性变换 $P$ 来降低数据的维度，即找到<u>正交基</u>来表示原始数据 $A$，目的是最大化降维后协方差矩阵的迹。目标函数如下：</p>
<script type="math/tex; mode=display">
\begin{gathered}
        B=PA,\ AE=ED\ (AE_{i}=D_{ii} E_{i})\\
        sort(D_{ii}),\ D_{ii}<=D_{jj}\ when \ i<j\\ 
        P=[E_{1}, E_{2}, \cdots, E_{d}]^{T} \\
        \arg \max_{P} tr(PAA^{T}P^{T}) = tr(\frac{1}{n} \sum_{i=1}^{n}(PA_{i})^{2})\\
        \text { s.t. } PP^{T}=I_{d\times d}.
    \end{gathered}</script><p>LLE 通过两个步骤来降低底层流形的维数：首先，计算高维数据的低维、邻域保留嵌入 $W$。其次，通过最小化损失函数方程得到输出 $Y$。目标函数在上面已经提过了。</p>
<h3 id="LLE的优点"><a href="#LLE的优点" class="headerlink" title="LLE的优点"></a>LLE的优点</h3><ul>
<li>保留高维空间中的局部线性关系。</li>
<li>可以处理有非线性关系的数据。</li>
<li>可以学习任何维度的局部线性低维流形。</li>
<li>计算输出时可以进行稀疏矩阵特征分解，计算复杂度比较小。</li>
</ul>
<h3 id="LLE的缺点"><a href="#LLE的缺点" class="headerlink" title="LLE的缺点"></a>LLE的缺点</h3><ul>
<li>LLE 只能用于非封闭流形，样本集需要密集均匀。</li>
<li>LLE对最近邻样本个数的选择很敏感，不同的近邻个数对最终的降维结果影响较大。</li>
</ul>
<h2 id="实验效果-MNIST"><a href="#实验效果-MNIST" class="headerlink" title="实验效果(MNIST)"></a>实验效果(MNIST)</h2><p>由于Sklearn已经对LLE做了很多的优化，需要代码的朋友可以之间调库解决：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.manifold <span class="keyword">import</span> LocallyLinearEmbedding</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">LLE</span>(<span class="params">test_data, train_data, component, neighbor</span>):</span></span><br><span class="line">    solver=LocallyLinearEmbedding(n_components = component, n_neighbors = neighbor)</span><br><span class="line">    solver.fit(train_data)</span><br><span class="line">    <span class="keyword">return</span> solver.transform(data)</span><br></pre></td></tr></table></figure>
<p>展示一些实验结果，有可视化的降维结果。然后我们在MNIST数据集上，使用PCA和LLE把数据降到2维，展示了当<strong>KNN</strong>的$k=1$时，当LLE的参数$k$变化的时候，准确率的影响：</p>
<p><img src="/2022/01/12/%E5%AD%90%E7%A9%BA%E9%97%B4%E5%AD%A6%E4%B9%A0(2)-LLE/LLE-Val.png" alt="LLE-Val" style="zoom:72%;"></p>
<center style="color:#C0C0C0;text-decoration:underline">图1. Performance of LE on MNIST.</center>

<p><img src="/2022/01/12/%E5%AD%90%E7%A9%BA%E9%97%B4%E5%AD%A6%E4%B9%A0(2)-LLE/k.png" alt="k" style="zoom:72%;"></p>
<center style="color:#C0C0C0;text-decoration:underline">图2. PCA(Baseline)和LE在MNIST数据集上的效果对比。</center>

<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>很多地方说的不是很细，本篇博客更重要的是去回答一些看论文中的问题。</p>


        <hr>
        <!-- Pager -->
        <ul class="pager">
          
          <li class="previous">
            <a href="/2022/01/13/子空间学习(3)-LE/" data-toggle="tooltip" data-placement="top" title="子空间学习(3)-LE">&larr; Previous Post</a>
          </li>
          
          
          <li class="next">
            <a href="/2022/01/11/子空间学习(1)-PCA/" data-toggle="tooltip" data-placement="top" title="子空间学习(1)-PCA">Next Post &rarr;</a>
          </li>
          
        </ul>

        
        <!-- tip start -->
        <!-- tip -->
<!-- tip start -->
<div class="tip">
  <p>
    
      If you like this blog or find it useful for you, you are welcome to comment on it. You are also welcome to share this blog, so that more people can participate in it. If the images used in the blog infringe your copyright, please contact the author to delete them. Thank you !
    
  </p>
</div>
<!-- tip end -->

        <!-- tip end -->
        

        
        <!-- Sharing Srtart -->
        <!-- Social Social Share Post -->
<!-- Docs:https://github.com/overtrue/share.js -->

<div class="social-share" data-initialized="true" data-disabled="tencent ,douban ,qzone ,linkedin ,facebook ,google ,diandian" data-wechat-qrcode-helper="" align="center">
  <ul class="list-inline text-center social-share-ul">
    <li class="social-share-li">
      <a target="_blank" class="social-share-icon icon-twitter">
        <i class="fa fa-twitter fa-1x" aria-hidden="true"></i>
      </a>
    </li>
    <li class="social-share-li">
      <a class="social-share-icon icon-wechat">
        <i class="fa fa-weixin fa-1x" aria-hidden="true"></i>
      </a>
    </li>
    <li class="social-share-li">
      <a target="_blank" class="social-share-icon icon-weibo">
        <i class="fa fa-weibo fa-1x" aria-hidden="true"></i>
      </a>
    </li>
    <li class="social-share-li">
      <a target="_blank" class="social-share-icon icon-qq">
        <i class="fa fa-qq fa-1x" aria-hidden="true"></i>
      </a>
    </li>
    <li class="social-share-li">
      <a target="_blank" class="social-share-icon" href="mailto:?subject=子空间学习(2)-LLE&body=Hi,I found this website and thought you might like it http://yoursite-url/2022/01/12/子空间学习(2)-LLE/">
        <i class="fa fa-envelope fa-1x" aria-hidden="true"></i>
      </a>
    </li>
  </ul>
</div>

<!-- css & js -->
<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css"> -->
<script defer="defer" async="true" src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>

        <!-- Sharing End -->
        
        <hr>

        <!-- comments start -->
        <!-- 1. gitalk comment -->

  <!-- gitalk start -->
  <!-- Docs:https://github.com/gitalk/gitalk/blob/master/readme-cn.md -->

  <div id="gitalk-container"></div>

  
    <!-- <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.js"></script> -->
    <script src="/js/comment/gitalk.js"></script>
  

  <script>
    var gitalk = new Gitalk({
      clientID: '65682c9d7fede4bb7fc5',
      clientSecret: '6b9080be7fdcaae6ae9bbd667c4d2af5f16eb118',
      repo: 'lhb7.github.io',
      owner: 'lhb7',
      admin: 'lhb7',
      id: 'Wed Jan 12 2022 12:24:17 GMT+0800', // Ensure uniqueness and length less than 50
      distractionFreeMode: false, // Facebook-like distraction free mode
      perPage: 10,
      pagerDirection: 'last',
      createIssueManually: true,
      language: 'zh-CN',
      proxy: ''
    });
    gitalk.render('gitalk-container');

    var gtFolded = () => {
      setTimeout(function () {
        let markdownBody = document.getElementsByClassName("markdown-body");
        let list = Array.from(markdownBody);
        list.forEach(item => {
          if (item.clientHeight > 250) {
            item.classList.add('gt-comment-body-folded');
            item.style.maxHeight = '250px';
            item.title = 'Click to Expand';
            item.onclick = function () {
              item.classList.remove('gt-comment-body-folded');
              item.style.maxHeight = '';
              item.title = '';
              item.onclick = null;
            };
          }
        })
      }, 800);
    }
  </script>

  <!-- gitalk end -->


<!-- 2. gitment comment -->


<!-- 3. disqus comment -->


        <!-- comments end -->
        <hr>

      </div>

      <!-- Catalog: Tabe of Content -->
      <!-- Table of Contents -->

    
      <aside id="sidebar">
        <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        
          <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#%E6%91%98%E8%A6%81%EF%BC%9A"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">摘要：</span></a></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#Question-amp-Answer%EF%BC%9A"><span class="toc-nav-number">2.</span> <span class="toc-nav-text">Question&amp;Answer：</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E5%81%87%E8%AE%BE"><span class="toc-nav-number">2.1.</span> <span class="toc-nav-text">假设</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E8%A7%A3%E5%86%B3%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-nav-number">2.2.</span> <span class="toc-nav-text">解决的问题</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E7%9B%AE%E6%A0%87%E5%87%BD%E6%95%B0"><span class="toc-nav-number">2.3.</span> <span class="toc-nav-text">目标函数</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E9%80%90%E5%AD%97%E7%90%86%E8%A7%A3Locally-Linear-Embedding%E7%9A%84%E5%90%AB%E4%B9%89"><span class="toc-nav-number">2.4.</span> <span class="toc-nav-text">逐字理解Locally Linear Embedding的含义</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Locally"><span class="toc-nav-number">2.4.1.</span> <span class="toc-nav-text">Locally</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Linear"><span class="toc-nav-number">2.4.2.</span> <span class="toc-nav-text">Linear</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Embedding"><span class="toc-nav-number">2.4.3.</span> <span class="toc-nav-text">Embedding</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E5%85%B7%E4%BD%93%E7%9A%84%E6%8E%A8%E5%AF%BC%E8%BF%87%E7%A8%8B"><span class="toc-nav-number">2.5.</span> <span class="toc-nav-text">具体的推导过程</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E8%AE%A8%E8%AE%BA"><span class="toc-nav-number">2.6.</span> <span class="toc-nav-text">讨论</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#PCA%E5%92%8CLLE%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-nav-number">2.6.1.</span> <span class="toc-nav-text">PCA和LLE的区别</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#LLE%E7%9A%84%E4%BC%98%E7%82%B9"><span class="toc-nav-number">2.6.2.</span> <span class="toc-nav-text">LLE的优点</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#LLE%E7%9A%84%E7%BC%BA%E7%82%B9"><span class="toc-nav-number">2.6.3.</span> <span class="toc-nav-text">LLE的缺点</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E5%AE%9E%E9%AA%8C%E6%95%88%E6%9E%9C-MNIST"><span class="toc-nav-number">2.7.</span> <span class="toc-nav-text">实验效果(MNIST)</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-nav-number">3.</span> <span class="toc-nav-text">总结</span></a></li></ol>
        
        </div>
      </aside>
    



      <!-- Sidebar Container -->
      <div class="
                col-lg-8 col-lg-offset-1
                col-md-10 col-md-offset-1
                sidebar-container">

        <!-- Featured Tags -->
        
        <section>
          <!-- no hr -->
          <h5>
            <a href="/tags/">FEATURED TAGS</a>
          </h5>
          <div class="tags">
            
            <a class="tag" href="/tags/#Python" title="Python">Python</a>
            
          </div>
        </section>
        

        <!-- Friends Blog -->
        
        <hr>
        <h5>FRIENDS</h5>
        <ul class="list-inline">

          
          <li>
            <a href="https://soptq.me/" target="_blank">Soptq</a>
          </li>
          
          <li>
            <a href="http://beantech.org" target="_blank">Bean Tech</a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</article>



<!-- anchorjs start -->
<!-- async load function -->
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script type="text/javascript">
  // async load function
  function async (u, c) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) {
      o.addEventListener('load', function(e) {
        c(null, e);
      }, false);
    }
    s.parentNode.insertBefore(o, s);
  };
</script>
<script type="text/javascript">
  //anchor-js, Doc:http://bryanbraun.github.io/anchorjs/
  async ("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js", function() {
    anchors.options = {
      visible: 'hover',
      placement: 'left',
      // icon: 'ℬ'
      icon: '❡'
    };
    anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
  });
</script>
<style>
  /* place left on bigger screen */
  @media all and (min-width: 800px) {
    .anchorjs-link {
      position: absolute;
      left: -0.75em;
      font-size: 1.1em;
      margin-top: -0.1em;
    }
  }
</style>

<!-- anchorjs end -->



		<!-- Footer (contains ThemeColor、viewer) -->
		<!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center">
          

          
            <li>
              <a target="_blank" href="https://github.com/lhb7">
                <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
          

          

          

          

          

          
            <li>
              <a target="_blank" href="https://www.zhihu.com/people/BinBin">
                <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa  fa-stack-1x fa-inverse">知</i>
                </span>
              </a>
            </li>
          

          

        </ul>
        <p class="copyright text-muted">
          Copyright &copy;
          Mr.Li
          2022
          <br>
          Theme by
          <a target="_blank" rel="noopener" href="http://beantech.org">BeanTech</a>
          <span style="display: inline-block; margin: 0 5px;">
            <i class="fa fa-heart"></i>
          </span>
          re-Ported by
          <a target="_blank" rel="noopener" href="https://v-vincen.life/">Live My Life</a>
          |
          <iframe style="margin-left: 2px; margin-bottom:-5px;" frameborder="0" scrolling="0" width="91px" height="20px" src="https://ghbtns.com/github-btn.html?user=V-Vincen&repo=V-Vincen.github.io&type=star&count=true"></iframe>
        </p>
      </div>
    </div>
  </div>
</footer>

<a id="rocket" href="#top" class=""></a>


  <!-- jQuery -->
  <script type="text/javascript" src="/js/jquery.min.js"></script>
  <!-- Bootstrap Core JavaScript -->
  <script type="text/javascript" src="/js/bootstrap.min.js"></script>
  <!-- Custom Theme JavaScript -->
  <script type="text/javascript" src="/js/hux-blog.min.js"></script>
  <!-- catalog -->
  <script async="true" type="text/javascript" src="/js/catalog.js"></script>
  <!-- totop(rocket) -->
  <script async="true" type="text/javascript" src="/js/totop.js"></script>

  

  
    <!-- Scroll start -->
    <script async="async" type="text/javascript" src="/js/scroll.js"></script>
    <!-- Scroll end -->
  

  

  
    <!-- Mouseclick -->
    <script type="text/javascript" src="/js/mouseclick.js" content='The first step is as good as half over...,Laugh and grow fat...,Man proposes God disposes...,When all else is lost the future still remains...,Wasting time is robbing oneself...,Sharp tools make good work...,Cease to struggle and you cease to live...,A friend in need is a friend indeed...,Faith can move mountains...' color='#9933CC,#339933,#66CCCC,#FF99CC,#CCCCFF,#6666CC,#663399,#66CC99,#FF0033'></script>
  

  
    <!-- ribbon -->
    <script type="text/javascript" src="/js/ribbonDynamic.js"></script>
  

  






  <!-- viewer start -->
  <!-- viewer start (Picture preview) -->
  
    <script async="async" type="text/javascript" src="/js/viewer/viewer.min.js"></script>
    <script async="async" type="text/javascript" src="/js/viewer/pic-viewer.js"></script>
  

  <!-- viewer end -->


<script>
  // async load function
  function async (u, c) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) {
      o.addEventListener('load', function (e) {
        c(null, e);
      }, false);
    }
    s.parentNode.insertBefore(o, s);
  }

  // fastClick.js
  async ("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function () {
    var $nav = document.querySelector("nav");
    if ($nav)
      FastClick.attach($nav);
    }
  )
</script>

<!-- Because of the native support for backtick-style fenced code blocks right within the Markdown is landed in Github Pages, From V1.6, There is no need for Highlight.js, so Huxblog drops it officially. -
https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0 - https://help.github.com/articles/creating-and-highlighting-code-blocks/ -->
<!-- <script> async ("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function () { hljs.initHighlightingOnLoad(); }) </script> <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet"> -->

<!-- jquery.tagcloud.js -->
<!-- <script> // only load tagcloud.js in tag.html if ($('#tag_cloud').length !== 0) { async ("http://yoursite-url/js/jquery.tagcloud.js", function () { $.fn.tagcloud.defaults = { // size: { start: 1, end: 1, unit: 'em' }, color: {
start: '#bbbbee', end: '#0085a1' } }; $('#tag_cloud a').tagcloud(); }) } </script> -->


		<!-- Search -->
		
		<div class="popup search-popup local-search-popup">
  <span class="popup-btn-close">
    ESC
  </span>
  <div class="container">
    <div class="row">
      <!-- <div class="col-md-9 col-md-offset-1"> -->
      <div class="col-lg-9 col-lg-offset-1 col-md-10 col-md-offset-1 local-search-content">

        <div class="local-search-header clearfix">

          <div class="local-search-input-wrapper">
            <span class="search-icon">
              <i class="fa fa-search fa-lg" style="margin: 25px 10px 25px 20px;"></i>
            </span>
            <input autocomplete="off" placeholder="SEARCH..." type="text" id="local-search-input">
          </div>
        </div>
        <div id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>


  
    <script src="/js/ziploader.js"></script>
  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.json";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    // monitor main search box;
    var onPopupClose = function (e) {
      $('.popup').fadeOut(300);
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $('.popup').fadeIn(300);
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }
    // get search zip version
    $.get('/searchVersion.json?t=' + (+new Date()), function (res) {
      if (localStorage.getItem('searchVersion') !== res) {
        localStorage.setItem('searchVersion', res);
        initSearchJson();
      }
    });

    function initSearchJson() {
      initLoad(['/search.flv'], {
        loadOptions: {
          success: function (obj) {
            localStorage.setItem('searchJson', obj['search.json'])
          },
          error: function (e) {
            return console.log(e)
          }
        },
        returnOptions: {
          'json': TYPE_TEXT
        },
        mimeOptions: {
          'json': 'application/json'
        }
      })
    }
    // search function;
    var searchFunc = function (search_id, content_id) {
      'use strict';
      isfetched = true;
      var datas = JSON.parse(localStorage.getItem('searchJson'));
      // console.log(search_id)
      var input = document.getElementById(search_id);
      var resultContent = document.getElementById(content_id);
      var inputEventFunction = function () {
        var searchText = input.value.trim().toLowerCase();
        var keywords = searchText.split(/[\s\-]+/);
        if (keywords.length > 1) {
          keywords.push(searchText);
        }
        var resultItems = [];
        if (searchText.length > 0) {
          // perform local searching
          datas.forEach(function (data) {
            var isMatch = false;
            var hitCount = 0;
            var searchTextCount = 0;
            var title = data.title
              ? data.title.trim()
              : '';
            var titleInLowerCase = title.toLowerCase();
            var content = data.content
              ? data.content.trim().replace(/<[^>]+>/g, "")
              : '';
            var contentInLowerCase = content.toLowerCase();
            var articleUrl = decodeURIComponent(data.url);

            var date = data.date;
            var dateTime = date.replace(/T/, " ").replace(/.000Z/, "");
            var imgUrl = data.header_img;
            


            var indexOfTitle = [];
            var indexOfContent = [];
            // only match articles with not empty titles
            keywords.forEach(function (keyword) {
              function getIndexByWord(word, text, caseSensitive) {
                var wordLen = word.length;
                if (wordLen === 0) {
                  return [];
                }
                var startPosition = 0,
                  position = [],
                  index = [];
                if (!caseSensitive) {
                  text = text.toLowerCase();
                  word = word.toLowerCase();
                }
                while ((position = text.indexOf(word, startPosition)) > -1) {
                  index.push({position: position, word: word});
                  startPosition = position + wordLen;
                }
                return index;
              }
              indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
              indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
            });
            if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
              isMatch = true;
              hitCount = indexOfTitle.length + indexOfContent.length;
            }
            // show search results
            if (isMatch) {
              // sort index by position of keyword
              [indexOfTitle, indexOfContent].forEach(function (index) {
                index.sort(function (itemLeft, itemRight) {
                  if (itemRight.position !== itemLeft.position) {
                    return itemRight.position - itemLeft.position;
                  } else {
                    return itemLeft.word.length - itemRight.word.length;
                  }
                });
              });
              // merge hits into slices
              function mergeIntoSlice(text, start, end, index) {
                var item = index[index.length - 1];
                var position = item.position;
                var word = item.word;
                var hits = [];
                var searchTextCountInSlice = 0;
                while (position + word.length <= end && index.length != 0) {
                  if (word === searchText) {
                    searchTextCountInSlice++;
                  }
                  hits.push({position: position, length: word.length});
                  var wordEnd = position + word.length;
                  // move to next position of hit
                  index.pop();
                  while (index.length != 0) {
                    item = index[index.length - 1];
                    position = item.position;
                    word = item.word;
                    if (wordEnd > position) {
                      index.pop();
                    } else {
                      break;
                    }
                  }
                }
                searchTextCount += searchTextCountInSlice;
                return {hits: hits, start: start, end: end, searchTextCount: searchTextCountInSlice};
              }
              var slicesOfTitle = [];
              if (indexOfTitle.length != 0) {
                slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
              }
              var slicesOfContent = [];
              while (indexOfContent.length != 0) {
                var item = indexOfContent[indexOfContent.length - 1];
                var position = item.position;
                var word = item.word;
                // cut out 100 characters
                var start = position - 20;
                var end = position + 80;
                if (start < 0) {
                  start = 0;
                }
                if (end < position + word.length) {
                  end = position + word.length;
                }
                if (end > content.length) {
                  end = content.length;
                }
                slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
              }
              // sort slices in content by search text's count and hits' count
              slicesOfContent.sort(function (sliceLeft, sliceRight) {
                if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                  return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                  return sliceRight.hits.length - sliceLeft.hits.length;
                } else {
                  return sliceLeft.start - sliceRight.start;
                }
              });
              // select top N slices in content
              var upperBound = parseInt('1');
              if (upperBound >= 0) {
                slicesOfContent = slicesOfContent.slice(0, upperBound);
              }
              // highlight title and content
              function highlightKeyword(text, slice) {
                var result = '';
                var prevEnd = slice.start;
                slice.hits.forEach(function (hit) {
                  result += text.substring(prevEnd, hit.position);
                  var end = hit.position + hit.length;
                  result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                  prevEnd = end;
                });
                result += text.substring(prevEnd, slice.end);
                return result;
              }
              var resultItem = '';

              // if (slicesOfTitle.length != 0) {   resultItem += "<li><a target='_blank' href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>"; } else {   resultItem += "<li><a target='_blank' href='" +
              // articleUrl + "' class='search-result-title'>" + title + "</a>"; } slicesOfContent.forEach(function (slice) {   resultItem += "<a target='_blank' href='" + articleUrl + "'><p class=\"search-result\">" + highlightKeyword(content, slice) +
              // "...</p></a>"; }); resultItem += "</li>";

              if (slicesOfTitle.length != 0) {
                resultItem += "<a target='_blank' href='" + articleUrl + "' class='search-result'><div class='search-result-left'><div class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</div><time class='search-result-date'>" + dateTime + "</time>";
              } else {
                resultItem += "<a target='_blank' href='" + articleUrl + "' class='search-result'><div class='search-result-left'><div class='search-result-title'>" + title + "</div><time class='search-result-date'>" + dateTime + "</time>";
              }
              slicesOfContent.forEach(function (slice) {
                resultItem += "<p class=\"search-result-content\">" + highlightKeyword(content, slice) + "...</p>";
              });
              resultItem += "</div><div class='search-result-right'><img class='media-image' src='" + imgUrl + "' width='64px' height='48px'></img></div></a>";

              resultItems.push({item: resultItem, searchTextCount: searchTextCount, hitCount: hitCount, id: resultItems.length});
            }
          })
        };

        if (keywords.length === 1 && keywords[0] === "") {
          resultContent.innerHTML = '<div id="no-result"></div>'
        } else if (resultItems.length === 0) {
          resultContent.innerHTML = '<div id="no-result"></div>'
        } else {
          resultItems.sort(function (resultLeft, resultRight) {
            if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
              return resultRight.searchTextCount - resultLeft.searchTextCount;
            } else if (resultLeft.hitCount !== resultRight.hitCount) {
              return resultRight.hitCount - resultLeft.hitCount;
            } else {
              return resultRight.id - resultLeft.id;
            }
          });
          var searchResultList = '<div class=\"search-result-list\">';
          resultItems.forEach(function (result) {
            searchResultList += result.item;
          })
          searchResultList += "</div>";
          resultContent.innerHTML = searchResultList;
        }
      }
      if ('auto' === 'auto') {
        input.addEventListener('input', inputEventFunction);
      } else {
        $('.search-icon').click(inputEventFunction);
        input.addEventListener('keypress', function (event) {
          if (event.keyCode === 13) {
            inputEventFunction();
          }
        });
      }
      // remove loading animation
      $('body').css('overflow', '');
      proceedsearch();
    }
    // handle and trigger popup window;
    $('.popup-trigger').click(function (e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc('local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });
    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function (e) {
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 && $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });

    document.addEventListener('mouseup', (e) => {
      var _con = document.querySelector(".local-search-content");
      if (_con) {
        if (!_con.contains(e.target)) {
          onPopupClose();
        }
      }
    });
  </script>


		
	<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>


</body>
</html>
